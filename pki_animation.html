<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PKI å¤šå ´æ™¯äº’å‹•æ•™å­¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f1f5f9;
            touch-action: none; 
        }

        .canvas-container {
            min-height: 600px;
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .draggable-key {
            cursor: grab;
            transition: all 0.2s;
            user-select: none;
        }

        .draggable-key:active { cursor: grabbing; transform: scale(1.1); }

        .drop-zone {
            transition: all 0.3s;
            border: 3px dashed transparent;
        }

        .drop-zone.active-target {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
            transform: scale(1.02);
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .data-terminal {
            font-family: monospace;
            background: #0f172a;
            color: #10b981;
            border-radius: 0.5rem;
            padding: 0.75rem;
            font-size: 0.8rem;
            min-height: 80px;
            word-break: break-all;
        }

        .scenario-btn.active {
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.5);
        }

        .eve-intercept-active {
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.4);
            border-color: #ef4444 !important;
        }
    </style>
</head>
<body class="p-4">
    <div class="max-w-6xl mx-auto">
        <header class="mb-6 text-center">
            <h1 class="text-2xl font-bold text-slate-800">PKI äº’å‹•å¯¦æˆ°ï¼šåŠ å¯†èˆ‡ç°½ç½²</h1>
            
            <!-- å ´æ™¯åˆ‡æ›å™¨ -->
            <div class="flex justify-center gap-2 mt-4">
                <button id="btn-conf" onclick="switchScenario('confidentiality')" class="scenario-btn active px-4 py-2 rounded-full text-sm font-bold bg-white text-slate-600 transition-all border">ğŸ” å‚³è¼¸åŠ å¯† (ä¿å¯†æ€§)</button>
                <button id="btn-auth" onclick="switchScenario('authentication')" class="scenario-btn px-4 py-2 rounded-full text-sm font-bold bg-white text-slate-600 transition-all border">âœï¸ æ•¸ä½ç°½ç½² (é©—è­‰æ€§)</button>
            </div>
        </header>

        <div class="grid grid-cols-1 xl:grid-cols-4 gap-6">
            <!-- å´é‚Šæ¬„ï¼šé‡‘é‘°åº« -->
            <div class="xl:col-span-1 space-y-4">
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                    <h3 class="font-bold text-slate-700 mb-3 text-sm flex items-center gap-2">ğŸ“¦ è§’è‰²é‡‘é‘°åº«</h3>
                    
                    <div class="space-y-3">
                        <!-- Alice -->
                        <div class="p-2 border border-red-100 rounded-lg bg-red-50/30">
                            <div class="text-[10px] font-bold text-red-500 mb-2">ALICE çš„é‡‘é‘°</div>
                            <div class="flex gap-2">
                                <div id="key-alice-priv" draggable="true" class="draggable-key text-2xl p-2 bg-red-100 rounded border border-red-200" data-key="alice-priv" title="Alice çš„ç§é‘°">ğŸ—ï¸</div>
                                <div id="key-bob-pub-alice" draggable="true" class="draggable-key text-2xl p-2 bg-white rounded border border-blue-200 text-blue-400" data-key="bob-pub" title="Bob çš„å…¬é‘°">ğŸ”‘</div>
                            </div>
                        </div>

                        <!-- Bob -->
                        <div class="p-2 border border-blue-100 rounded-lg bg-blue-50/30">
                            <div class="text-[10px] font-bold text-blue-500 mb-2">BOB çš„é‡‘é‘°</div>
                            <div class="flex gap-2">
                                <div id="key-bob-priv" draggable="true" class="draggable-key text-2xl p-2 bg-blue-100 rounded border border-blue-200" data-key="bob-priv" title="Bob çš„ç§é‘°">ğŸ—ï¸</div>
                                <div id="key-alice-pub-bob" draggable="true" class="draggable-key text-2xl p-2 bg-white rounded border border-red-200 text-red-400" data-key="alice-pub" title="Alice çš„å…¬é‘°">ğŸ”‘</div>
                            </div>
                        </div>

                        <!-- Eve -->
                        <div class="p-2 border border-slate-200 rounded-lg bg-slate-100">
                            <div class="text-[10px] font-bold text-slate-600 mb-2">EVE (é§­å®¢) çš„å·¥å…·</div>
                            <div class="flex gap-2">
                                <div id="key-eve-priv" draggable="true" class="draggable-key text-2xl p-2 bg-slate-800 rounded border border-slate-900" data-key="eve-priv" title="Eve çš„ç§é‘°">ğŸ—ï¸</div>
                                <div id="key-alice-pub-eve" draggable="true" class="draggable-key text-2xl p-2 bg-white rounded border border-red-200 text-red-400 opacity-60" data-key="alice-pub" title="ç›œå–çš„ Alice å…¬é‘°">ğŸ”‘</div>
                                <div id="key-bob-pub-eve" draggable="true" class="draggable-key text-2xl p-2 bg-white rounded border border-blue-200 text-blue-400 opacity-60" data-key="bob-pub" title="ç›œå–çš„ Bob å…¬é‘°">ğŸ”‘</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                    <h3 class="font-bold text-slate-700 mb-2 text-sm">ğŸ“¡ æ•¸æ“šæµæ•¸æ“š</h3>
                    <div id="sim-data" class="data-terminal">æº–å‚™å°±ç·’...</div>
                </div>
                
                <button onclick="location.reload()" class="w-full py-2 bg-slate-200 hover:bg-slate-300 text-slate-600 rounded-lg text-xs font-bold transition-all">ğŸ”„ é‡ç½®å¯¦é©—å®¤</button>
            </div>

            <!-- ä¸»ç•«å¸ƒ -->
            <div class="xl:col-span-3">
                <div class="canvas-container p-8 flex flex-col justify-between">
                    <!-- è§’è‰²å±¤ -->
                    <div class="flex justify-around items-center">
                        <div class="text-center relative">
                            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center text-3xl border-2 border-red-300">ğŸ‘©â€ğŸ’»</div>
                            <span class="text-xs font-bold text-slate-600">Alice</span>
                        </div>
                        <div class="text-center">
                            <div id="eve-avatar" class="w-14 h-14 bg-slate-800 rounded-full flex items-center justify-center text-2xl border-2 border-slate-600 opacity-30 grayscale transition-all">ğŸ¦¹</div>
                            <span class="text-[10px] font-bold text-slate-400">Eve</span>
                        </div>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center text-3xl border-2 border-blue-300">ğŸ‘¨â€ğŸ’¼</div>
                            <span class="text-xs font-bold text-slate-600">Bob</span>
                        </div>
                    </div>

                    <!-- è»Œé“å±¤ -->
                    <div class="relative h-40 flex items-center px-12">
                        <div class="absolute inset-x-12 h-1 bg-slate-200 rounded-full"></div>
                        <div id="packet-path" class="absolute left-0 transition-all duration-700 ease-in-out" style="left: 0%;">
                            <div id="main-packet" class="drop-zone w-24 h-24 bg-white border-2 border-slate-200 rounded-xl shadow-lg flex flex-col items-center justify-center relative">
                                <span id="packet-icon" class="text-4xl">âœ‰ï¸</span>
                                <div id="status-badge" class="absolute -top-3 -right-3 text-2xl"></div>
                                <span id="packet-label" class="text-[9px] font-bold mt-2 text-slate-400">åŸå§‹éƒµä»¶</span>
                            </div>
                        </div>
                    </div>

                    <!-- å¼•å°å±¤ -->
                    <div id="guide-box" class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg shadow-sm transition-all duration-300">
                        <h4 id="guide-title" class="font-bold text-blue-800 mb-1">å ´æ™¯ï¼šå‚³è¼¸åŠ å¯†</h4>
                        <p id="guide-text" class="text-blue-700 text-sm">è«‹å°‡ <b>Bob çš„å…¬é‘° (è—è‰²ğŸ”‘)</b> æ‹–åˆ°éƒµä»¶ä¸Šä¾†åŠ å¯†å…§å®¹ã€‚</p>
                        <div class="flex gap-2 mt-3">
                            <button id="send-btn" class="hidden bg-blue-600 text-white px-4 py-1 rounded-full text-xs font-bold hover:bg-blue-700 transition-all">ç™¼é€ â”</button>
                            <button id="continue-btn" class="hidden bg-slate-600 text-white px-4 py-1 rounded-full text-xs font-bold hover:bg-slate-700 transition-all">æ•¸æ“šç¹¼çºŒå‚³é€ â”</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl text-white font-bold shadow-2xl opacity-0 transition-all z-50 pointer-events-none"></div>

    <script>
        let currentScenario = 'confidentiality';
        let step = 1; // 1: Alice, 2: Eve (Middle), 3: Bob
        let isProcessed = false;
        const msg = "ç§˜å¯†ï¼šæ˜å¤©ä¸‹åˆä¸‰é»é–‹æœƒã€‚";
        const encryptedMsg = "0xAF882D...[å¯†æ–‡å…§å®¹]";
        const signedMsg = "ç§˜å¯†ï¼šæ˜å¤©ä¸‹åˆä¸‰é»é–‹æœƒã€‚\n[ç°½ç« : 0x92E1...]";

        function switchScenario(type) {
            currentScenario = type;
            step = 1;
            isProcessed = false;
            
            document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(type === 'confidentiality' ? 'btn-conf' : 'btn-auth').classList.add('active');
            
            resetUI();
        }

        function resetUI() {
            const packet = document.getElementById('main-packet');
            const path = document.getElementById('packet-path');
            
            path.style.left = "0%";
            packet.classList.remove('shake', 'eve-intercept-active');
            document.getElementById('status-badge').innerText = "";
            document.getElementById('packet-icon').innerText = "âœ‰ï¸";
            document.getElementById('packet-label').innerText = "åŸå§‹éƒµä»¶";
            document.getElementById('sim-data').innerText = msg;
            document.getElementById('sim-data').style.color = "#10b981";
            document.getElementById('send-btn').classList.add('hidden');
            document.getElementById('continue-btn').classList.add('hidden');
            document.getElementById('eve-avatar').classList.add('opacity-30', 'grayscale');
            
            if (currentScenario === 'confidentiality') {
                updateGuide("å ´æ™¯ï¼šå‚³è¼¸åŠ å¯†", "ç›®æ¨™ï¼šç¢ºä¿åªæœ‰ Bob èƒ½çœ‹è¦‹å…§å®¹ã€‚è«‹å°‡ <b>Bob çš„å…¬é‘° (è—è‰²ğŸ”‘)</b> æ‹–åˆ°éƒµä»¶ä¸Šé€²è¡ŒåŠ å¯†ã€‚");
            } else {
                updateGuide("å ´æ™¯ï¼šæ•¸ä½ç°½ç½²", "ç›®æ¨™ï¼šè­‰æ˜ä¿¡ä»¶æ˜¯ç”± Alice è¦ªç­†æ’°å¯«ã€‚è«‹å°‡ <b>Alice çš„ç§é‘° (ç´…è‰²ğŸ—ï¸)</b> æ‹–åˆ°éƒµä»¶ä¸Šé€²è¡Œç°½ç½²ã€‚");
            }
        }

        function updateGuide(title, text) {
            document.getElementById('guide-title').innerText = title;
            document.getElementById('guide-text').innerHTML = text;
        }

        // æ‹–æ”¾é‚è¼¯
        let draggedKey = null;
        document.querySelectorAll('.draggable-key').forEach(k => {
            k.addEventListener('dragstart', e => draggedKey = e.target.dataset.key);
        });

        const dropTarget = document.getElementById('main-packet');
        dropTarget.addEventListener('dragover', e => {
            e.preventDefault();
            dropTarget.classList.add('active-target');
        });
        dropTarget.addEventListener('dragleave', () => dropTarget.classList.remove('active-target'));
        dropTarget.addEventListener('drop', e => {
            e.preventDefault();
            dropTarget.classList.remove('active-target');
            handleAction(draggedKey);
        });

        function handleAction(key) {
            if (step === 1) {
                // Alice éšæ®µ
                if (currentScenario === 'confidentiality') {
                    if (key === 'bob-pub') {
                        processStep("ğŸ”’", "å·²åŠ å¯†", encryptedMsg, "#f87171", "åŠ å¯†å®Œæˆï¼è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•ç™¼é€å°åŒ…ã€‚");
                    } else {
                        showToast("åŠ å¯†å¤±æ•—ï¼Alice æ‡‰è©²ä½¿ç”¨å°æ–¹çš„å…¬é‘°ä¾†ã€Œä¸Šé–ã€ã€‚", "red");
                        shake(dropTarget);
                    }
                } else {
                    if (key === 'alice-priv') {
                        processStep("âœï¸", "å·²ç°½ç½²", signedMsg, "#60a5fa", "ç°½ç½²å®Œæˆï¼è«‹é»æ“Šç™¼é€ï¼Œå°‡å¸¶æœ‰ç°½åçš„éƒµä»¶é€å‡ºã€‚");
                    } else {
                        showToast("ç°½ç½²å¤±æ•—ï¼åªæœ‰ Alice è‡ªå·±çš„ç§é‘°æ‰èƒ½ç”¢ç”Ÿç¨ä¸€ç„¡äºŒçš„ç°½åã€‚", "red");
                        shake(dropTarget);
                    }
                }
            } else if (step === 2) {
                // Eve æ””æˆªéšæ®µ
                const eveAvatar = document.getElementById('eve-avatar');
                if (key === 'eve-priv') {
                    showToast("Eve å˜—è©¦ç”¨è‡ªå·±çš„ç§é‘°è§£å¯†... å¤±æ•—ï¼å¯†æ–‡èˆ‡å¥¹çš„é‡‘é‘°ä¸åŒ¹é…ã€‚", "red");
                    shake(eveAvatar);
                    updateDataDisplay("[ERROR] ç„¡æ³•è§£å¯†ï¼šå¯†é‘°ä¸æ­£ç¢º", "#ef4444");
                    setTimeout(() => updateDataDisplay(currentScenario === 'confidentiality' ? encryptedMsg : signedMsg, currentScenario === 'confidentiality' ? "#f87171" : "#60a5fa"), 1200);
                } else if (key === 'alice-pub' || key === 'bob-pub') {
                    showToast("Eve å˜—è©¦ç”¨å…¬é‘°ç ´è§£... æ²’ç”¨ï¼å…¬é‘°åªèƒ½ç”¨ä¾†ã€ŒåŠ å¯†ã€ï¼Œä¸èƒ½è§£é–‹åˆ¥äººçš„é–ã€‚", "orange");
                    shake(eveAvatar);
                }
            } else if (step === 3) {
                // Bob éšæ®µ
                if (currentScenario === 'confidentiality') {
                    if (key === 'bob-priv') {
                        finish("ğŸ“–", "å·²é‚„åŸ", msg, "#10b981", "Bob ä½¿ç”¨è‡ªå·±çš„ç§é‘°é †åˆ©è§£é–‹å¯†æ–‡ï¼");
                    } else {
                        showToast("è§£å¯†å¤±æ•—ï¼ä¸–ç•Œä¸Šåªæœ‰ Bob çš„ç§é‘°èƒ½è§£é–‹é€™å°ä¿¡ã€‚", "red");
                        shake(dropTarget);
                    }
                } else {
                    if (key === 'alice-pub') {
                        finish("âœ…", "å·²é©—è­‰", msg, "#10b981", "é©—è­‰æˆåŠŸï¼Bob ä½¿ç”¨ Alice çš„å…¬é‘°ç¢ºèªäº†é€™å°ä¿¡ç¢ºå¯¦ä¾†è‡ª Aliceã€‚");
                    } else {
                        showToast("é©—è­‰å¤±æ•—ï¼éœ€ä½¿ç”¨å¯„ä»¶äºº Alice çš„å…¬é‘°ä¾†æ¯”å°ç°½ç« ã€‚", "red");
                        shake(dropTarget);
                    }
                }
            }
        }

        function processStep(badge, label, data, color, guide) {
            document.getElementById('status-badge').innerText = badge;
            document.getElementById('packet-label').innerText = label;
            document.getElementById('sim-data').innerText = data;
            document.getElementById('sim-data').style.color = color;
            document.getElementById('send-btn').classList.remove('hidden');
            document.getElementById('guide-text').innerText = guide;
            isProcessed = true;
        }

        document.getElementById('send-btn').onclick = () => {
            const path = document.getElementById('packet-path');
            const packet = document.getElementById('main-packet');
            const eveAvatar = document.getElementById('eve-avatar');
            
            // ç§»å‹•åˆ°ä¸­é–“ (Eve)
            path.style.left = "calc(50% - 48px)";
            document.getElementById('send-btn').classList.add('hidden');
            step = 2;
            
            setTimeout(() => {
                eveAvatar.classList.remove('opacity-30', 'grayscale');
                packet.classList.add('eve-intercept-active');
                updateGuide("âš ï¸ æ•¸æ“šè¢«æ””æˆªï¼", "å°åŒ…ç›®å‰åœ¨é§­å®¢ Eve æ‰‹ä¸­ã€‚è©¦è‘—å°‡ <b>Eve çš„é‡‘é‘° (é»‘è‰²å·¥å…·å€)</b> æ‹–åˆ°å°åŒ…ä¸Šé€²è¡Œç ´è§£ã€‚çœ‹çœ‹æ‹¿åˆ°äº†å…¬é‘°å’Œç§é‘°çš„å¥¹èƒ½å¦æˆåŠŸï¼Ÿ");
                document.getElementById('continue-btn').classList.remove('hidden');
            }, 700);
        };

        document.getElementById('continue-btn').onclick = () => {
            const path = document.getElementById('packet-path');
            const packet = document.getElementById('main-packet');
            
            packet.classList.remove('eve-intercept-active');
            path.style.left = "calc(100% - 110px)";
            document.getElementById('continue-btn').classList.add('hidden');
            step = 3;
            
            setTimeout(() => {
                if (currentScenario === 'confidentiality') {
                    updateGuide("Bob å·²æ”¶åˆ°å¯†æ–‡", "æ•¸æ“šå·²å®‰å…¨é€é”ã€‚è«‹å°‡ <b>Bob çš„ç§é‘° (è—è‰²ğŸ—ï¸)</b> æ‹–åˆ°å°åŒ…ä¸Šè§£é–å…§å®¹ã€‚");
                } else {
                    updateGuide("Bob å·²æ”¶åˆ°ç°½ç½²ä»¶", "æ•¸æ“šå·²é€é”ã€‚è«‹å°‡ <b>Alice çš„å…¬é‘° (ç´…è‰²ğŸ”‘)</b> æ‹–åˆ°å°åŒ…ä¸Šä¾†é©—è­‰å¯„ä»¶äººèº«ä»½ã€‚");
                }
            }, 700);
        };

        function finish(icon, label, data, color, guide) {
            document.getElementById('packet-icon').innerText = icon;
            document.getElementById('packet-label').innerText = label;
            document.getElementById('sim-data').innerText = data;
            document.getElementById('sim-data').style.color = color;
            document.getElementById('status-badge').innerText = "";
            updateGuide("å¯¦é©—æˆåŠŸï¼", guide + "<br><br><b>å°çµï¼š</b>" + 
                (currentScenario === 'confidentiality' ? "å³ä½¿é§­å®¢æ””æˆªä¸¦æ“æœ‰å¤šæŠŠå…¬é‘°ï¼Œæ²’æœ‰æ­£ç¢ºçš„ã€ç§é‘°ã€ä¾ç„¶ç„¡æ³•çªºæ¢éš±ç§ã€‚" : "æ•¸ä½ç°½ç« è­‰æ˜äº†èº«ä»½ã€‚é§­å®¢ç„¡æ³•å½é€  Alice çš„ç§é‘°ï¼Œå› æ­¤ä¹Ÿç„¡æ³•å½é€ å¥¹çš„èº«ä»½ã€‚"));
        }

        function updateDataDisplay(text, color) {
            const el = document.getElementById('sim-data');
            el.innerText = text;
            el.style.color = color;
        }

        function showToast(m, c) {
            const t = document.getElementById('toast');
            t.innerText = m;
            t.style.backgroundColor = c === 'red' ? '#ef4444' : (c === 'orange' ? '#f59e0b' : '#3b82f6');
            t.classList.add('opacity-100');
            setTimeout(() => t.classList.remove('opacity-100'), 2500);
        }

        function shake(el) {
            el.classList.add('shake');
            setTimeout(() => el.classList.remove('shake'), 500);
        }

        resetUI();
    </script>
</body>
</html>
